<!DOCTYPE html>
 <?php header('Access-Control-Allow-Origin: *'); ?>
 <html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main Search Page</title>
    <link rel="stylesheet" type="text/css" href="css/main-search.css">
</head>
<!--<script src="main-search.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    
    function loadPage() {
        document.getElementById("locationText").focus();
    }
    
    function clearInput() {
        document.getElementById("locationText").placeholder = "";
    }
    function convertUnits() {
        var temp = document.getElementById("currTemperature").textContent;
        var tempInteger = Math.round(parseFloat(temp));
        var units = document.getElementById("units").textContent;
        if (units === "°F"){
            tempInteger = (tempInteger-32)*5/9;
            document.getElementById("units").innerHTML = '°C';
            tempInteger = tempInteger.toString();
            tempInteger = Math.round(parseFloat(tempInteger));
            document.getElementById("currTemperature").innerHTML = tempInteger;
        } else {
            tempInteger = (tempInteger/5*9)+32;
            tempInteger = tempInteger.toString();
            tempInteger = Math.round(parseFloat(tempInteger));
            document.getElementById("units").innerHTML = '°F';
            document.getElementById("currTemperature").innerHTML = tempInteger;
        }
    }
    
    var animateInterval;
    var currentIndex=0;
    var values = [1.0,1.1,1.2,1.3,1.4,1.5,1.4,1.3,1.2,1.1];
    
    function animateFunc() {
        var image = document.getElementById('icon');
        var string = '-webkit-filter: brightness(' + values[currentIndex] +')';
        image.setAttribute('style',string);
        if (!values[currentIndex]) {
           currentIndex = 0;
        } else {
           currentIndex++;
        }
    }
    
    function change() {        
        animateInterval = setInterval(animateFunc, 100);
    }
    function unchange() {
        clearInterval(animateInterval); 
        var image = document.getElementById('icon');
        image.setAttribute('style','-webkit-filter: brightness(1.0)');
        currentIndex = 0;
    }
    
    function submitform(){
        var request = new XMLHttpRequest();
        var location = document.getElementById("locationText").value;
        var url = "http://0.0.0.0:8080/SearchServlet?location=" + location;
        alert(url);
        request.open("GET",url,false);
        var handleRequestStateChange = function(){  
            if(request.readyState == 4 && request.status==200){
                document.getElementById("weatherDisplayArea").style.visibility = "visible";
                document.getElementById("errorMessage").style.visibility = "hidden";
                alert("if loaded");
                var result = JSON.parse(this.responseText);
                alert(result);
            } else {
                //error request status 439
                document.getElementById("weatherDisplayArea").style.visibility = "hidden";
                document.getElementById("errorMessage").style.visibility = "visible";
                console.log("error")
            }
        }
        request.onreadystatechange = handleRequestStateChange;
        request.send(null);
    }
    
</script>
<body onload="loadPage()">
    <div id="weatherDisplayArea">
        <p>
            <label id="currLocation">Los Angeles, CA </label>
            <label id="currDate">| Mar 10, 2020</label>
        </p>
        <p>
            <img id="icon" onmouseover="change()" onmouseout="unchange()" src="img/activity.png" height="42" width="42" >
            <label id="currTemperature">25</label>
            <label id="units">°C</label>
        </p>
        <p><label id="currDescription">Sunny</label></p>
    </div>
    <p id="errorMessage">No weather data found</p>

    <form id="mainform" onsubmit="submitform()">
        <p><input type="text" id="locationText" name="locationText" placeholder="Enter location (city or zip)" oninput="clearInput()"><br><br></p>
        <p style="margin-left: -140px; margin-top: -10px; margin-bottom: -10px; font-size: 11px">°C&nbsp;&nbsp;&nbsp;°F</p>
        <p>
            <label class="switch">
            <input type="checkbox" id="unitChanger">
            <span class="slider round" id="unitSlider" onclick="convertUnits()"></span>
            </label>
            <input id="submitButton" type="submit" value="Show me the weather">
        </p>
    </form>
</body>  
<footer>
    <div id="nav" class="navbar">
        <a href="index.html"class="active">
            <img name="icon" src="img/home.png" height="60" width="60">
        </a>
        <a href="vacationPlanning.html"class="active">
            <img name="icon" src="img/vacation.png" height="60" width="60">
        </a>
        <a href="activityPlanning.html"class="active">
            <img name="icon" src="img/activity.png" height="60" width="60">
        </a>
        <a href="weather-analysis.html" class="active">
            <img name="icon" src="img/analysis.png" height="60" width="60">
        </a>
        
    </div>
</footer>   
</html>
